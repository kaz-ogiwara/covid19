let gData,gRegions=[];const LAST_DATE="2020-02-29T00:00:00+09:00",AGE_LABELS=["80代","70代","60代","50代","40代","30代","20代","10代","10歳未満"],REGION_THRESHOLD=10,COLORS={default:"#33ddcc",dark:"#399",selected:"#ec2",gender:{f:"#FE9",m:"#2B9"}},init=()=>{const e=()=>{const e=()=>{let e=[],a=new Date("2020-01-15T00:00:00+09:00"),o=new Date(LAST_DATE);for(let t=a;t<=o;t.setDate(t.getDate()+1)){let a=t.getMonth()+1,o=t.getDate(),n=a.toString()+"/"+o.toString();e.push(n)}return e};let a=$("#transition-chart");a.empty(),a.html("<canvas></canvas>");let o=a.find("canvas")[0],t={type:"bar",data:{labels:e(),datasets:[{label:"患者数",backgroundColor:COLORS.default,data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!1},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(e){return e[0].xLabel},label:function(e,a){return e.yLabel+"名"}}},scales:{xAxes:[{stacked:!0,gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!0,gridLines:{display:!0,color:"rgba(255, 255, 255, 0.3)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(e,a,o){return e.toString()+" 名"}}}]}}};a.width()>=400&&(t.options.aspectRatio=1.5),a.width()>=600&&(t.options.aspectRatio=1.8);let n=[];e().forEach(function(e,a){n.push(0)}),gData.forEach(function(a,o){e().forEach(function(e,o){if(a[3]===e)if("total"===$("#transition-block").find(".switch.selected").attr("value"))for(let e=o;e<n.length;e++)n[e]++;else n[o]++})}),t.data.datasets[0].data=n;let i=o.getContext("2d");window.myChart=new Chart(i,t)},a=(e,a)=>{const t=e=>("東京"===e&&(e="東京都"),"京都"===e&&(e="京都府"),"大阪"===e&&(e="大阪府"),"東京都"!==e&&"大阪府"!==e&&"京都府"!==e&&"北海道"!==e&&"調査中"!==e&&"県"!==e.slice(-1)&&(e+="県"),-1!==e.indexOf("中国")&&(e="中国居住者"),e);let n=$("#region-chart");n.empty(),n.html("<canvas></canvas>");let i=n.find("canvas")[0];gRegions=[],gData.forEach(function(e,a){let o=-1;gRegions.forEach(function(a,n){a.label==t(e[6])&&(o=n)}),o>=0?gRegions[o].value++:gRegions.push({label:t(e[6]),value:1})}),gRegions.sort(function(e,a){return e.value<=a.value?1:-1});let c=[],s=[],l=[];gRegions.forEach(function(a,t){c.push(a.label),s.push(a.value),"中国居住者"===a.label||"調査中"===a.label?l.push("rgba(255,255,255,0.4)"):a.label===e?l.push(COLORS.selected):l.push(o(a.label))});let d={type:"horizontalBar",data:{labels:c,datasets:[{label:"",backgroundColor:l,data:s}]},options:{aspectRatio:.8,animation:a,responsive:!0,legend:{display:!1},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(e){return e[0].yLabel},label:function(e,a){return e.xLabel+"名"}}},scales:{xAxes:[{position:"top",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(e,a,o){return e.toString()+" 名"}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};n.outerWidth()>=400&&(d.options.aspectRatio=1),n.outerWidth()>=600&&(d.options.aspectRatio=1.2);let r=i.getContext("2d");window.myChart=new Chart(r,d)},o=e=>{let a="#666";return gRegions.forEach(function(o,t){o.label===e&&(a=COLORS.default)}),a};$.getJSON("data/data.json",function(t){gData=t,e(),a("",!0),(()=>{const e=$("#japan-map").width();let t=[];[{code:1,jp:"北海道",en:"Hokkaido"},{code:2,jp:"青森県",en:"Aomori"},{code:3,jp:"岩手県",en:"Iwate"},{code:4,jp:"宮城県",en:"Miyagi"},{code:5,jp:"秋田県",en:"Akita"},{code:6,jp:"山形県",en:"Yamagata"},{code:7,jp:"福島県",en:"Fukushima"},{code:8,jp:"茨城県",en:"Ibaraki"},{code:9,jp:"栃木県",en:"Tochigi"},{code:10,jp:"群馬県",en:"Gunma"},{code:11,jp:"埼玉県",en:"Saitama"},{code:12,jp:"千葉県",en:"Chiba"},{code:13,jp:"東京都",en:"Tokyo"},{code:14,jp:"神奈川県",en:"Kanagawa"},{code:15,jp:"新潟県",en:"Niigata"},{code:16,jp:"富山県",en:"Toyama"},{code:17,jp:"石川県",en:"Ishikawa"},{code:18,jp:"福井県",en:"Fukui"},{code:19,jp:"山梨県",en:"Yamanashi"},{code:20,jp:"長野県",en:"Nagano"},{code:21,jp:"岐阜県",en:"Gifu"},{code:22,jp:"静岡県",en:"Shizuoka"},{code:23,jp:"愛知県",en:"Aichi"},{code:24,jp:"三重県",en:"Mie"},{code:25,jp:"滋賀県",en:"Shiga"},{code:26,jp:"京都府",en:"Kyoto"},{code:27,jp:"大阪府",en:"Osaka"},{code:28,jp:"兵庫県",en:"Hyogo"},{code:29,jp:"奈良県",en:"Nara"},{code:30,jp:"和歌山県",en:"Wakayama"},{code:31,jp:"鳥取県",en:"Tottori"},{code:32,jp:"島根県",en:"Shimane"},{code:33,jp:"岡山県",en:"Okayama"},{code:34,jp:"広島県",en:"Hiroshima"},{code:35,jp:"山口県",en:"Yamaguchi"},{code:36,jp:"徳島県",en:"Tokushima"},{code:37,jp:"香川県",en:"Kagawa"},{code:38,jp:"愛媛県",en:"Ehime"},{code:39,jp:"高知県",en:"Kochi"},{code:40,jp:"福岡県",en:"Fukuoka"},{code:41,jp:"佐賀県",en:"Saga"},{code:42,jp:"長崎県",en:"Nagasaki"},{code:43,jp:"熊本県",en:"Kumamoto"},{code:44,jp:"大分県",en:"Oita"},{code:45,jp:"宮崎県",en:"Miyazaki"},{code:46,jp:"鹿児島県",en:"Kagoshima"},{code:47,jp:"沖縄県",en:"Okinawa"}].forEach(function(e,a){t.push({code:e.code,jp:e.jp,en:e.en,color:o(e.jp),hoverColor:COLORS.selected,prefectures:[e.code]})}),$("#japan-map").japanMap({areas:t,width:e,borderLineColor:"#fcfcfc",borderLineWidth:.25,lineColor:"#ccc",lineWidth:1,drawsBoxLine:!1,showsPrefectureName:!1,movesIslands:!0,fontSize:11,onSelect:function(e){a(e.name,!1)}})})(),(()=>{$wrapper=$("#age-chart"),$wrapper.empty(),$wrapper.html("<canvas></canvas>"),$canvas=$wrapper.find("canvas")[0];let e={f:[0,0,0,0,0,0,0,0,0,0],m:[0,0,0,0,0,0,0,0,0,0]};gData.forEach(function(a,o){let t,n=-1;"男"==a[5]&&(t="m"),"女"==a[5]&&(t="f"),AGE_LABELS.forEach(function(e,o){a[4]===e&&(n=o)}),t&&n>=0&&e[t][n]++});let a={type:"horizontalBar",data:{labels:AGE_LABELS,datasets:[{label:"女性",backgroundColor:COLORS.gender.f,data:e.f},{label:"男性",backgroundColor:COLORS.gender.m,data:e.m}]},options:{aspectRatio:1,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function(e){return e[0].yLabel},label:function(e,a){return a.datasets[e.datasetIndex].label+"："+e.value+"名"}}},scales:{xAxes:[{position:"top",color:"yellow",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function(e,a,o){return e.toString()+" 名"}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};$wrapper.outerWidth()>=400&&(a.options.aspectRatio=1.2),$wrapper.outerWidth()>=600&&(a.options.aspectRatio=1.4);let o=$canvas.getContext("2d");window.myChart=new Chart(o,a)})(),$("#container").addClass("show")}),$("#transition-block").find(".switch").on("click",function(){$("#transition-block").find(".switch").removeClass("selected"),$(this).addClass("selected"),e()})};$(function(){init()});