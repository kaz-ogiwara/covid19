"use strict";var gData,gRegions=[],LANG=$("html").attr("lang"),REGION_THRESHOLD=10,COLORS={default:"#3DC",dark:"#399",patient:"#ED9",discharge:"#3CA",test:"#3DC",dead:"#E95",positive:"#E95",selected:"#EC2",gender:{f:"#FE9",m:"#2B9"}},LABELS={ja:{chart:{patients:{dead:"\u6B7B\u4EA1\u6570",discharge:"\u9000\u9662\u6570",patient:"\u60A3\u8005\u6570"},surveys:{patient:"\u6709\u75C7\u6570",positive:"\u967D\u6027\u8005\u6570",test:"\u691C\u67FB\u6570"},demography:{f:"\u5973\u6027",m:"\u7537\u6027"}},age:{"10代":"10\u4EE3","20代":"20\u4EE3","30代":"30\u4EE3","40代":"40\u4EE3","50代":"50\u4EE3","60代":"60\u4EE3","70代":"70\u4EE3","80代":"80\u4EE3","90代":"90\u4EE3","10歳未満":"10\u6B73\u672A\u6E80"}},en:{chart:{patients:{dead:"Deaths",discharge:"Discharged",patient:"Cases"},surveys:{patient:"Cases",positive:"Positive",test:"PCR Tests"},demography:{f:"Female",m:"Male"}},age:{"10代":"10s","20代":"20s","30代":"30s","40代":"40s","50代":"50s","60代":"60s","70代":"70s","80代":"80s","90代":"90s","10歳未満":"Under 10"}}},init=function(){var a=function(){var a=$("#patients-chart");a.empty(),a.html("<canvas></canvas>");var b=a.find("canvas")[0],c=$("#patients-block").find(".switch.selected").attr("value"),d={type:"bar",data:{labels:[],datasets:[{label:LABELS[LANG].chart.patients.dead,backgroundColor:COLORS.dead,borderColor:COLORS.dead,data:[]},{label:LABELS[LANG].chart.patients.discharge,backgroundColor:COLORS.discharge,borderColor:COLORS.discharge,data:[]},{label:LABELS[LANG].chart.patients.patient,backgroundColor:COLORS.patient,borderColor:COLORS.patient,data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!1,callbacks:{title:function title(a){var b=a[0].xLabel+" "+gData.transition[a[0].index][2]+":00";return{ja:"",en:"As of "}[LANG]+b+{ja:{total:"\u6642\u70B9 \u7D2F\u8A08",new:"\u6642\u70B9\u65B0\u898F"},en:{total:" Total",new:" New cases"}}[LANG][c]},label:function label(a){var b,d=gData.transition[a.index],e={ja:"\u540D",en:""};if("new"===c&&1<=a.index){var f=gData.transition[a.index-1];b=[LABELS[LANG].chart.patients.patient+": "+(d[5]-f[5])+e[LANG],LABELS[LANG].chart.patients.discharge+": "+(d[6]-f[6])+e[LANG],LABELS[LANG].chart.patients.dead+": "+(d[7]-f[7])+e[LANG]]}else b=[LABELS[LANG].chart.patients.patient+": "+d[5]+e[LANG],LABELS[LANG].chart.patients.discharge+": "+d[6]+e[LANG],LABELS[LANG].chart.patients.dead+": "+d[7]+e[LANG]];return b}}},scales:{xAxes:[{stacked:!("total"!==c),gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!1,gridLines:{display:!0,zeroLineColor:"rgba(255,255,255,0.7)",color:"rgba(255, 255, 255, 0.3)"},ticks:{beginAtZero:!0,fontColor:"rgba(255,255,255,0.7)",callback:function callback(a){return a.toString()}}}]}}};"new"===c&&(d.type="line",d.data.datasets.forEach(function(a){a.fill=!1,a.lineTension=.1,a.pointBackgroundColor="#242a3c",a.pointBorderWidth=1.5,a.pointRadius=2.5,a.borderWidth=4})),400<=a.width()&&(d.options.aspectRatio=1.5),600<=a.width()&&(d.options.aspectRatio=1.8),gData.transition.forEach(function(a,b){if(d.data.labels.push(a[0]+"/"+a[1]),"new"===c&&1<=b){var e=gData.transition[b-1];d.data.datasets[2].data.push(a[5]-e[5]),d.data.datasets[1].data.push(a[6]-e[6]),d.data.datasets[0].data.push(a[7]-e[7])}else d.data.datasets[2].data.push(a[5]),d.data.datasets[1].data.push(a[6]),d.data.datasets[0].data.push(a[7])});var e=b.getContext("2d");window.myChart=new Chart(e,d)},b=function(){var a=$("#surveys-chart");a.empty(),a.html("<canvas></canvas>");var b=a.find("canvas")[0],c=$("#surveys-block").find(".switch.selected").attr("value"),d={type:"bar",data:{labels:[],datasets:[{label:LABELS[LANG].chart.surveys.patient,backgroundColor:[],borderColor:COLORS.patient,data:[]},{label:LABELS[LANG].chart.surveys.positive,backgroundColor:[],borderColor:COLORS.positive,data:[]},{label:LABELS[LANG].chart.surveys.test,backgroundColor:[],borderColor:COLORS.test,data:[]}]},options:{aspectRatio:1.2,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!1,callbacks:{title:function title(a){var b=a[0].xLabel+" "+gData.transition[a[0].index][2]+":00";return{ja:"",en:"As of "}[LANG]+b+{ja:{total:"\u6642\u70B9 \u7D2F\u8A08",new:"\u6642\u70B9\u65B0\u898F"},en:{total:" Total",new:" New cases"}}[LANG][c]},label:function label(a){var b,d=gData.transition[a.index],e={ja:"\u540D",en:""};if("new"===c&&1<=a.index){var f=gData.transition[a.index-1];""!==f[3]&&(b=[LABELS[LANG].chart.surveys.test+": "+(d[3]-f[3])+e[LANG],LABELS[LANG].chart.surveys.positive+": "+(d[4]-f[4])+e[LANG],LABELS[LANG].chart.surveys.patient+": "+(d[5]-f[5])+e[LANG]])}else b=[LABELS[LANG].chart.surveys.test+": "+d[3]+e[LANG],LABELS[LANG].chart.surveys.positive+": "+d[4]+e[LANG],LABELS[LANG].chart.surveys.patient+": "+d[5]+e[LANG]];return b}}},scales:{xAxes:[{stacked:!("total"!==c),gridLines:{display:!1},ticks:{fontColor:"rgba(255,255,255,0.7)"}}],yAxes:[{location:"bottom",stacked:!1,gridLines:{display:!0,zeroLineColor:"rgba(255,255,255,0.7)",color:"rgba(255, 255, 255, 0.3)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function callback(a){return a.toString()}}}]}}};"new"===c&&(d.type="line",d.data.datasets.forEach(function(a){a.fill=!1,a.lineTension=.1,a.pointBackgroundColor="#242a3c",a.pointBorderWidth=1.5,a.pointRadius=2.5,a.borderWidth=4})),400<=a.width()&&(d.options.aspectRatio=1.5),600<=a.width()&&(d.options.aspectRatio=1.8),gData.transition.forEach(function(a,b){if(d.data.labels.push(a[0]+"/"+a[1]),"new"===c&&1<=b){var f=gData.transition[b-1];d.data.datasets[2].data.push(a[3]-f[3]),d.data.datasets[1].data.push(a[4]-f[4]),d.data.datasets[0].data.push(a[5]-f[5])}else d.data.datasets[2].data.push(a[3]),d.data.datasets[1].data.push(a[4]),d.data.datasets[0].data.push(a[5]);var e=3<=a[0]&&4<=a[1]?COLORS.dark:COLORS.test;d.data.datasets[2].backgroundColor.push(e),d.data.datasets[1].backgroundColor.push(COLORS.positive),d.data.datasets[0].backgroundColor.push(COLORS.patient)});var e=b.getContext("2d");window.myChart=new Chart(e,d)},c=function(a){var b="rgba(90, 90, 90, 0.3)";return 1<=a&&(b=COLORS.dark),a>=REGION_THRESHOLD&&(b=COLORS["default"]),b},d=function(){var a=$("#japan-map").width(),b=[];gData.prefectures.forEach(function(a){b.push({code:a.code,jp:a.jp,en:a.en,color:c(a.value),hoverColor:COLORS.selected,prefectures:[a.code]})}),$("#japan-map").japanMap({areas:b,width:a,borderLineColor:"#fcfcfc",borderLineWidth:.25,lineColor:"#ccc",lineWidth:1,drawsBoxLine:!1,showsPrefectureName:!1,movesIslands:!0,fontSize:11,onHover:function onHover(a){f(a.code,0)}})},e=function(){var a=$("#demography-chart");a.empty(),a.html("<canvas></canvas>");var b=a.find("canvas")[0],c={type:"horizontalBar",data:{labels:[],datasets:[{label:LABELS[LANG].chart.demography.f,backgroundColor:COLORS.gender.f,data:[]},{label:LABELS[LANG].chart.demography.m,backgroundColor:COLORS.gender.m,data:[]}]},options:{aspectRatio:.9,responsive:!0,legend:{display:!0,labels:{fontColor:"rgba(255, 255, 255, 0.7)"}},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function title(a){return a[0].yLabel},label:function label(a,b){return b.datasets[a.datasetIndex].label+": "+a.value+{ja:"\u540D",en:""}[LANG]}}},scales:{xAxes:[{position:"top",color:"yellow",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function callback(a){return a.toString()}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)",callback:function callback(a){return LABELS[LANG].age[a]}}}]}}};400<=a.outerWidth()&&(c.options.aspectRatio=1.1),600<=a.outerWidth()&&(c.options.aspectRatio=1.3);var d=0;for(var f in gData.demography){for(var g in gData.demography[f]){var h=gData.demography[f][g];0===d&&c.data.labels.push(g),c.data.datasets[d].data.push(h)}d++}var e=b.getContext("2d");window.myChart=new Chart(e,c)},f=function(a){var b=$("#region-chart");b.empty(),b.html("<canvas></canvas>");var d=b.find("canvas")[0],e={type:"horizontalBar",data:{labels:[],datasets:[{label:"",backgroundColor:[],data:[]}]},options:{aspectRatio:.6,animation:{duration:1e3},responsive:!0,legend:{display:!1},title:{display:!1},tooltips:{xPadding:24,yPadding:12,displayColors:!0,callbacks:{title:function title(a){return a[0].yLabel},label:function label(a){return a.xLabel+{ja:" \u540D",en:" cases"}[LANG]}}},scales:{xAxes:[{position:"top",gridLines:{color:"rgba(255,255,255,0.2)"},ticks:{suggestedMin:0,fontColor:"rgba(255,255,255,0.7)",callback:function callback(a){return a.toString()}}}],yAxes:[{gridLines:{color:"rgba(255,255,255,0.1)"},ticks:{fontColor:"rgba(255,255,255,0.7)"}}]}}};400<=b.outerWidth()&&(e.options.aspectRatio=.8),600<=b.outerWidth()&&(e.options.aspectRatio=1),""!==a&&(e.options.animation.duration=0),gData.prefectures.forEach(function(b){1<=b.value&&(e.data.labels.push(b[LANG]),e.data.datasets[0].data.push(b.value),a===b.code?e.data.datasets[0].backgroundColor.push(COLORS.selected):e.data.datasets[0].backgroundColor.push(c(b.value)))});var f=d.getContext("2d");window.myChart=new Chart(f,e)},g=function(){["last","transition","demography","prefectures"].forEach(function(a){$(".updated-"+a).text(gData.updated[a][LANG])})};(function loadData(){$.getJSON("https://raw.githubusercontent.com/kaz-ogiwara/covid19/master/data/data.json",function(c){gData=c,b(),a(),e(),d(),f(""),g(),$("#container").addClass("show")})})(),function bindEvents(){$(".switch").on("click",function(){$(this).siblings(".switch").removeClass("selected"),$(this).addClass("selected"),$(this).closest("#patients-block")[0]&&a(),$(this).closest("#surveys-block")[0]&&b()})}()};$(function(){init()});
